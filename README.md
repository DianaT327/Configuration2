# Тараненко Диана. ИКБО-21-24. Вариант №25 
Разработать инструмент визуализации графа зависимостей для менеджера 
пакетов. Готовые средства (менеджеры пакетов, библиотеки) для получения 
зависимостей использовать нельзя. 
## Этап 1. Минимальный прототип с конфигурацией 
### Общее описание
Цель: создать минимальное CLI-приложение и сделать его настраиваемым. 
#### Требования: 
1. Источником настраиваемых пользователем параметров является 
конфигурационный файл формата XML. 
2. К настраиваемым параметрам относятся:
– Имя анализируемого пакета.
– URL-адрес репозитория или путь к файлу тестового репозитория.
– Режим работы с тестовым репозиторием.
– Версия пакета.
– Режим вывода зависимостей в формате ASCII-дерева. 
4. (только для этого этапа) При запуске приложения вывести все параметры, 
настраиваемые пользователем, в формате ключ-значение. 
5. Реализовать и продемонстрировать обработку ошибок для всех параметров. 
6. Результат выполнения этапа сохранить в репозиторий стандартно 
оформленным коммитом.
### Описание всех функций и настроек
#### Функции:
* parse_config(config_path) - парсит конфигурационный XML файл и возвращает параметры. Параметры: config_path (str) - путь к XML файлу конфигурации. Возвращает: dict - словарь с параметрами конфигурации.
* display_parameters(config) - выводит все параметры в формате ключ-значение. Параметры: config (dict)- словарь с параметрами конфигурации.
#### Настройки конфигурационного файла:
##### Обязательные параметры:
* package_name (str) - название анализируемого пакета.
* repository_url (str) - URL-адрес репозитория или путь к файлу.
##### Опциональные параметры:
* test_repo_mode (str) - режим работы с тестовым репозиторием. По умолчанию: "local".
* package_version (str) - версия пакета для анализа. По умолчанию: "1.0.0".
* ascii_tree_output (bool) - режим вывода зависимостей в формате ASCII-дерева. По умолчанию: False.
### Описание команд для сборки проекта и запуска тестов
Программа требует только стандартные библиотеки Python: xml.etree.ElementTree, sys, os. Тестирование проводится путем запуска приложения с передачей конфигурационного XML-файла в качестве аргумента командной строки.
### Тестирование
Результат работы программы с корректным файлом и параметрами
<img width="779" height="247" alt="config" src="https://github.com/user-attachments/assets/b0688345-918b-4d71-9185-cbe788c16845" />
<br>
Результат работы программы с ошибкой в имени пакета (отсутствие имени пакета)
<img width="999" height="42" alt="config_error_package" src="https://github.com/user-attachments/assets/16f9437c-b26e-48de-ab60-90a8ae5291b7" />
<br>
Результат работы программы с ошибкой в URL (отсутствие URL-адреса)
<img width="1013" height="44" alt="config_error_url" src="https://github.com/user-attachments/assets/6074ba93-bdf2-44b7-a374-96fa0a488569" />
<br>
Результат работы программы с ошибкой в режиме работы с тестовым репозиторием (недопустимый режим работы)
<img width="1106" height="62" alt="config_error_mode" src="https://github.com/user-attachments/assets/a59c14ab-02f0-4888-9df0-c2d2eaa24ecb" />
<br>
Результат работы программы с ошибкой в версии пакета (некорректный формат версии)
<img width="1111" height="62" alt="config_error_version" src="https://github.com/user-attachments/assets/9baef9b8-0d3e-4c8c-a975-33c8705cf0d9" />
<br>
Результат работы программы с ошибкой в режиме вывода зависимостей в формате ASCII-дерева (недопустимое значение)
<img width="1091" height="63" alt="config_error_ascii" src="https://github.com/user-attachments/assets/b64cb183-16e9-49c1-bdc4-190bc01e55e6" />
## Этап 2. Сбор данных 
### Общее описание
Цель: реализовать основную логику получения данных о зависимостях для их 
дальнейшего анализа и визуализации. Запрещено пользоваться менеджерами 
пакетов и сторонними библиотеками для получения информации о зависимостях 
пакетов. 
#### Требования: 
1. Использовать формат пакетов Alpine Linux (apk). 
2. Информацию необходимо получить для заданной пользователем версии 
пакета. 
3. Извлечь информацию о прямых зависимостях заданного пользователем 
пакета, используя URL-адрес репозитория. 
4. (только для этого этапа) Вывести на экран все прямые зависимости 
заданного пользователем пакета. 
5. Результат выполнения этапа сохранить в репозиторий стандартно 
оформленным коммитом. 
### Описание всех функций и настроек
#### Функции:
* parse_config(config_path) - парсит конфигурационный XML файл и возвращает параметры с валидацией. Параметры: config_path (str) - путь к XML файлу конфигурации. Возвращает: dict - словарь с параметрами конфигурации.
* download_and_parse_apkindex(repository_url) - скачивает и парсит APKINDEX.tar.gz из репозитория Alpine Linux. Параметры: repository_url (str) - URL репозитория Alpine. Возвращает: str - содержимое APKINDEX файла.
* find_package_dependencies(apkindex_content, package_name, package_version) - ищет зависимости пакета в содержимом APKINDEX. Параметры: apkindex_content (str) -содержимое APKINDEX файла, package_name (str) - имя пакета для поиска, package_version (str) - версия пакета. Возвращает: tuple: (dependencies, package_exists) - список зависимостей и флаг существования пакета
* get_alpine_dependencies(package_name, package_version, repository_url) - получает прямые зависимости пакета Alpine Linux. Параметры: package_name (str) - имя пакета, package_version (str) - версия пакета, repository_url (str) - URL репозитория. Возвращает: list - список зависимостей пакета.
* display_dependencies(package_name, dependencies) - выводит прямые зависимости пакета в читаемом формате. Параметры: package_name (str) - имя пакета, dependencies (list) - список зависимостей.
#### Настройки конфигурационного файла:
##### Обязательные параметры:
* package_name (str) - название анализируемого пакета.
* repository_url (str) - URL-адрес репозитория или путь к файлу.
##### Опциональные параметры:
* test_repo_mode (str) - режим работы с тестовым репозиторием. По умолчанию: "local".
* package_version (str) - версия пакета для анализа. По умолчанию: "1.0.0".
* ascii_tree_output (bool) - режим вывода зависимостей в формате ASCII-дерева. По умолчанию: False.
### Описание команд для сборки проекта и запуска тестов
Программа требует только стандартные библиотеки Python: xml.etree.ElementTree, sys, os, urllib.request, urllib.error, gzip, tarfile, io.BytesIO. Тестирование проводится путем запуска приложения с передачей конфигурационного XML-файла в качестве аргумента командной строки
### Тестирование
Результат работы программы с корректными прямыми зависимостями в файле 
<img width="805" height="252" alt="config" src="https://github.com/user-attachments/assets/340afc15-a862-4a78-8a4d-f4125a6f8316" />
<br>
Результат работы программы с пакетом, не имеющим прямых зависимостей
<img width="795" height="173" alt="test_1" src="https://github.com/user-attachments/assets/a18f921d-e524-4217-8a92-81de764eaa00" />
<br>
Результат работы программы с несуществующим пакетом
<img width="878" height="116" alt="test_2" src="https://github.com/user-attachments/assets/43cafe94-ba7c-4c05-8572-67e477f69794" />
## Этап 3. Основные операции 
### Общее описание
Цель: построить граф зависимостей (с учетом транзитивности) и выполнить 
основные операции над ним. 
#### Требования: 
1. Получение графа зависимостей реализовать алгоритмом DFS с рекурсией. 
2. Корректно обработать случаи наличия циклических зависимостей. 
3. Поддержать режим тестирования. Вместо URL реального репозитория, дать 
возможность пользователю указать путь к файлу описания графа 
репозитория, где пакеты называются большими латинскими буквами. 
Продемонстрировать функциональность этого этапа на различных случаях 
работы с тестовым репозиторием. 
4. Результат выполнения этапа сохранить в репозиторий стандартно 
оформленным коммитом.
### Описание всех функций и настроек
#### Функции:
* parse_config(config_path) - парсит конфигурационный XML файл и возвращает параметры с валидацией. Параметры: config_path (str) - путь к XML файлу конфигурации. Возвращает: dict - словарь с параметрами конфигурации.
* download_and_parse_apkindex(repository_url) - скачивает и парсит APKINDEX.tar.gz из репозитория Alpine Linux. Параметры: repository_url (str) - URL репозитория Alpine. Возвращает: str - содержимое APKINDEX файла.
* get_all_packages_from_apkindex(repository_url) - получает список всех пакетов из APKINDEX репозитория. Параметры: repository_url (str) - URL репозитория. Возвращает: list - список всех пакетов.
* get_all_packages_from_test_file(test_repo_path) - получает список всех пакетов из тестового файла. Параметры: test_repo_path (str) - путь к тестовому файлу. Возвращает: list - список пакетов.
* find_package_dependencies(apkindex_content, package_name, package_version) - ищет зависимости пакета в содержимом APKINDEX. Параметры: apkindex_content (str) - содержимое APKINDEX, package_name (str) - имя пакета, package_version (str) - версия пакета. Возвращает: list - список зависимостей.
* read_dependencies_from_test_file(package_name, test_repo_path) - читает зависимости пакета из тестового файла. Параметры: package_name (str) - имя пакета, test_repo_path (str) - путь к тестовому файлу. Возвращает: list - список зависимостей.
* get_package_dependencies(package_name, package_version, repository_url, is_test_mode) - универсальная функция для получения зависимостей пакета. Параметры: package_name (str) - имя пакета, package_version (str) - версия пакета, repository_url (str) - URL репозитория или путь к файлу, is_test_mode (bool) - флаг тестового режима. Возвращает: list - список зависимостей.
* build_dependency_graph(package_name, package_version, repository_path, is_test_mode, depth=0, max_depth=10, chain=None) - рекурсивно строит граф зависимостей для пакета с использованием DFS. Параметры: package_name (str) - имя пакета, package_version (str) - версия пакета, repository_path (str) - путь к репозиторию, is_test_mode (bool) - флаг тестового режима, depth (int) - текущая глубина рекурсии, max_depth (int) - максимальная глубина рекурсии, chain (list) - текущая цепочка зависимостей.
* build_complete_dependency_graph(repository_url, is_test_mode) - строит полный граф всех пакетов в репозитории. Параметры: repository_url (str) - URL репозитория или путь к файлу, is_test_mode (bool) - флаг тестового режима.
* display_dependency_graph() - выводит построенный граф зависимостей в консоль.
* create_test_files() - создает тестовые файлы для демонстрации работы программы.
* interactive_test_mode() - запускает интерактивный режим тестирования.
#### Настройки конфигурационного файла:
##### Обязательные параметры:
* package_name (str) - название анализируемого пакета.
* repository_url (str) - URL-адрес репозитория или путь к файлу.
##### Опциональные параметры:
* test_repo_mode (str) - режим работы с тестовым репозиторием. По умолчанию: "local".
* package_version (str) - версия пакета для анализа. По умолчанию: "1.0.0".
* ascii_tree_output (bool) - режим вывода зависимостей в формате ASCII-дерева. По умолчанию: False.
#### Глобальные переменные:
* APKINDEX_CACHE - кеш для содержимого APKINDEX файла.
* APKINDEX_URL - URL последнего загруженного APKINDEX.
* dependency_graph (dict) - хранит граф зависимостей: пакет → список зависимостей.
* visited (set) - отслеживает полностью обработанные пакеты.
* visiting (set) - отслеживает пакеты в текущей цепочке (для обнаружения циклов).
### Описание команд для сборки проекта и запуска тестов
Программа требует только стандартные библиотеки Python: xml.etree.ElementTree, sys, os, urllib.request, urllib.error, gzip, tarfile, io.BytesIO. Тестирование может проводиться как в интерактивном режиме (пользователь указывает путь к файлу описания графа репозитория), так и путем запуска с конфигурационным XML-файлом.
### Тестирование
Результат работы программы с линейной структурой графа зависимости
<img width="809" height="500" alt="test_simple" src="https://github.com/user-attachments/assets/1c2b5c68-568f-493a-9d63-8dbbdb82ceca" />
<br>
Результат работы программы со сложной структурой графа зависимости
<img width="815" height="609" alt="test_complex" src="https://github.com/user-attachments/assets/0c8c2f59-2d3a-4154-aec8-f1fb5cecb78a" />
<br>
Результат работы программы с алмазной структурой графа зависимости
<img width="729" height="475" alt="test_diamond" src="https://github.com/user-attachments/assets/128b015d-f4fb-4b85-9171-f77d2403b7ae" />
<br>
Результат работы программы с циклической структурой графа зависимости
<img width="840" height="474" alt="test_cycle" src="https://github.com/user-attachments/assets/0b3cad3e-b120-45e9-ba94-138b1f554f92" />

